{% extends "base.html" %}
{% block title %}{{ person.name }} - Biography{% endblock %}
{% block content %}
    <div class="container mx-auto p-4">
        <!-- Person Header -->
        <section class="flex flex-col md:flex-row items-start gap-8 mb-12">
            <div class="w-full md:w-1/4">
                {% if person.image and person.image.url %}
                    <img src="{{ person.image.url }}"
                         alt="Image of {{ person.name }}"
                         class="w-full h-auto object-cover rounded-lg shadow-md">
                {% else %}
                    <div class="w-full h-96 bg-gray-200 rounded-lg flex items-center justify-center text-gray-600 shadow-md">
                        <span>No Image</span>
                    </div>
                {% endif %}
                <div class="mt-4">
                    {% if person.chat_enabled %}
                        <a href="{% url 'bio_chat' person.slug %}"
                           class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline block text-center">
                            AI와 대화하기
                        </a>
                    {% endif %}
                </div>
            </div>
            <div class="w-full md:w-3/4">
                <h1 class="text-4xl font-bold mb-4">{{ person.name }}</h1>
                <h2 class="text-2xl text-gray-600 mb-6">Biography</h2>
                <p class="text-base text-gray-700 leading-relaxed">{{ person.biography|linebreaks }}</p>
            </div>
        </section>
        <!-- Life Events Section -->
        <section>
            <h2 class="text-3xl font-bold mb-8">Life Events</h2>
            <!-- Horizontal Timeline Bar -->
            <div class="pb-4 mb-8 border-b border-gray-200">
                <div class="flex overflow-x-auto space-x-2">
                    {% for year in years %}
                        <button hx-get="{% url 'bio_detail' person.slug %}?year={{ year }}"
                                hx-target="#event-list"
                                hx-swap="innerHTML"
                                class="px-4 py-2 font-semibold rounded-full text-sm whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 {% if year == selected_year %}bg-blue-600 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                            {{ year }}
                        </button>
                    {% endfor %}
                </div>
            </div>
            <!-- Vertical Event List Container -->
            <div id="event-list" class="relative border-l-2 border-gray-200 ml-3">{% include "_event_list.html" %}</div>
        </section>
        <!-- Comments Section -->
        {% include "_comments.html" with person=person comments=comments %}
    </div>
    <script>
        function toggleReplyForm(commentId) {
            const form = document.getElementById('reply-form-' + commentId);
            if (form) {
                form.classList.toggle('hidden');
            }
        }
        
        // 댓글 작성 후 폼 초기화
        document.getElementById('comment-form').addEventListener('htmx:after-request', function(event) {
            if (event.detail.successful) {
                this.reset();
            }
        });
    </script>
{% endblock %}
